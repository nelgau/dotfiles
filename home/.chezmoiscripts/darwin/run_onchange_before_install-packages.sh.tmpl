{{- if (eq .chezmoi.os "darwin") -}}
#!/bin/bash
set -eufo pipefail

{{ $taps := list
     "homebrew/cask-fonts"
     "nelgau/fpga"
     "nelgau/misc"
     "riscv-software-src/riscv" -}}
{{ $brews := list
     "autoconf"
     "automake"
     "bat"
     "cmake"
     "coreutils"
     "curl"
     "dockutil"
     "ffmpeg"
     "findutils"
     "gh"
     "git"
     "git-lfs"
     "htop"
     "icarus-verilog"
     "jq"
     "lesspipe"
     "libusb"
     "libftdi"
     "lsusb"
     "make"
     "moreutils"
     "nelgau/fpga/verilator@4.106"
     "ninja"
     "neofetch"
     "neovim"
     "node"
     "pipenv"
     "poetry"
     "pyenv"
     "pyenv-virtualenv"
     "python"
     "pyright"
     "tmux"
     "wget"
     "yt-dlp"
     "zsh" -}}
{{ $heads := list
     "nelgau/fpga/ecpprog"
     "nelgau/fpga/nextpnr-ecp5"
     "riscv-software-src/riscv/riscv-tools"
     "yosys" -}}
{{ $casks := list
     "1password"
     "1password-cli"
     "audacity"
     "blender"
     "balenaetcher"
     "discord"
     "evernote"
     "font-inconsolata"
     "google-chrome"
     "gtkwave"
     "hammerspoon"
     "hiddenbar"
     "iterm2"
     "kicad"
     "musescore"
     "nelgau/misc/ares-emulator"
     "parallels"
     "rectangle"
     "slack"
     "spotify"
     "sublime-text"
     "todoist"
     "transmission"
     "vagrant"
     "visual-studio-code"
     "vlc"
     "zoom" -}}

brew bundle --no-lock --file=/dev/stdin <<EOF
{{ range ($taps | sortAlpha | uniq) -}}
tap "{{ . }}"
{{ end -}}
{{ range ($brews | sortAlpha | uniq) -}}
brew "{{ . }}"
{{ end -}}
{{ range ($heads | sortAlpha | uniq) -}}
brew "{{ . }}", args: ["HEAD"]
{{ end -}}
{{ range ($casks | sortAlpha | uniq) -}}
cask "{{ . }}"
{{ end -}}
EOF
{{ end -}}
